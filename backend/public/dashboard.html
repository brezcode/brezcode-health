<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BrezCode Health - Business Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #fdf2f8 0%, #fef3ff 100%);
            min-height: 100vh;
        }
        
        .header {
            background: white;
            padding: 16px 20px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
        }
        
        .title {
            font-size: 24px;
            font-weight: 700;
            color: #1f2937;
        }
        
        .subtitle {
            font-size: 14px;
            color: #6b7280;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .user-info {
            font-size: 14px;
            color: #6b7280;
        }
        
        .button {
            background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(236, 72, 153, 0.3);
        }
        
        .button-outline {
            background: white;
            color: #6b7280;
            border: 1px solid #d1d5db;
        }
        
        .button-outline:hover {
            background: #f9fafb;
            border-color: #9ca3af;
        }
        
        .main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }
        
        .dashboard-header {
            margin-bottom: 30px;
        }
        
        .dashboard-title {
            font-size: 32px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 8px;
        }
        
        .dashboard-subtitle {
            color: #6b7280;
            font-size: 16px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
        }
        
        .stat-header {
            font-size: 14px;
            font-weight: 600;
            color: #6b7280;
            margin-bottom: 8px;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 8px;
        }
        
        .stat-change {
            font-size: 14px;
        }
        
        .stat-change.positive {
            color: #059669;
        }
        
        .stat-change.negative {
            color: #dc2626;
        }
        
        .content-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }
        
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .card {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
        }
        
        .card-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: #1f2937;
        }
        
        .card-subtitle {
            font-size: 14px;
            color: #6b7280;
            margin-top: 4px;
        }
        
        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }
        
        .action-card {
            padding: 20px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .action-card:hover {
            border-color: #ec4899;
            background: #fef7f7;
        }
        
        .action-icon {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
            margin-bottom: 12px;
        }
        
        .action-title {
            font-size: 16px;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 4px;
        }
        
        .action-desc {
            font-size: 14px;
            color: #6b7280;
        }
        
        .activity-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 16px 0;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        .activity-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-top: 6px;
        }
        
        .activity-content {
            flex: 1;
        }
        
        .activity-title {
            font-size: 14px;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 4px;
        }
        
        .activity-desc {
            font-size: 13px;
            color: #6b7280;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }
        
        .error {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
            padding: 16px;
            border-radius: 8px;
            text-align: center;
        }
        
        @media (max-width: 768px) {
            .content-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .actions-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-left">
            <div class="logo">❤️</div>
            <div>
                <div class="title">BrezCode Health</div>
                <div class="subtitle">Business Dashboard</div>
            </div>
        </div>
        
        <div class="header-right">
            <div class="user-info" id="userInfo">Loading...</div>
            <button class="button button-outline" onclick="logout()">Logout</button>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main">
        <div class="dashboard-header">
            <h1 class="dashboard-title">Dashboard Overview</h1>
            <p class="dashboard-subtitle">Monitor your BrezCode Health platform performance and AI training</p>
        </div>
        
        <!-- Loading State -->
        <div id="loading" class="loading">
            <p>Loading dashboard data...</p>
        </div>
        
        <!-- Error State -->
        <div id="error" class="error" style="display: none;">
            <p id="errorMessage">Failed to load dashboard data</p>
        </div>
        
        <!-- Dashboard Content -->
        <div id="dashboard" style="display: none;">
            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">Total Users</div>
                    <div class="stat-value" id="totalUsers">0</div>
                    <div class="stat-change positive" id="userGrowth">+0% this week</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-header">Active Assessments</div>
                    <div class="stat-value" id="activeAssessments">0</div>
                    <div class="stat-change" id="assessmentChange">In progress today</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-header">Completion Rate</div>
                    <div class="stat-value" id="completionRate">0%</div>
                    <div class="stat-change positive" id="completionChange">Improving</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-header">AI Performance</div>
                    <div class="stat-value" id="aiPerformance">0%</div>
                    <div class="stat-change positive" id="aiChange">Empathy + Accuracy</div>
                </div>
            </div>
            
            <!-- Content Grid -->
            <div class="content-grid">
                <!-- Main Content -->
                <div class="main-content">
                    <!-- Quick Actions -->
                    <div class="card">
                        <div class="card-header">
                            <div>
                                <div class="card-title">Quick Actions</div>
                                <div class="card-subtitle">Manage your BrezCode Health platform</div>
                            </div>
                        </div>
                        
                        <div class="actions-grid" id="quickActions">
                            <!-- Actions will be loaded here -->
                        </div>
                    </div>
                </div>
                
                <!-- Sidebar -->
                <div class="sidebar">
                    <!-- AI Training Status -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">🧠 AI Training Status</div>
                        </div>
                        
                        <div style="margin-bottom: 16px;">
                            <div style="display: flex; justify-between; margin-bottom: 8px;">
                                <span style="font-size: 14px; font-weight: 600;">Overall Training</span>
                                <span style="font-size: 14px; color: #6b7280;" id="trainingProgress">85%</span>
                            </div>
                            <div style="background: #e5e7eb; height: 8px; border-radius: 4px; overflow: hidden;">
                                <div id="trainingBar" style="background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%); height: 100%; width: 85%; transition: width 0.3s ease;"></div>
                            </div>
                        </div>
                        
                        <div style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 20px;">
                            <div style="display: flex; justify-between; align-items: center;">
                                <span style="font-size: 13px; color: #6b7280;">Dr. Sakura Sessions</span>
                                <span style="background: #f3f4f6; color: #374151; padding: 2px 8px; border-radius: 4px; font-size: 12px;" id="activeSessions">0 Active</span>
                            </div>
                            <div style="display: flex; justify-between; align-items: center;">
                                <span style="font-size: 13px; color: #6b7280;">Medical Accuracy</span>
                                <span style="background: #dcfce7; color: #166534; padding: 2px 8px; border-radius: 4px; font-size: 12px;" id="medicalAccuracy">98.2%</span>
                            </div>
                            <div style="display: flex; justify-between; align-items: center;">
                                <span style="font-size: 13px; color: #6b7280;">Empathy Score</span>
                                <span style="background: #dbeafe; color: #1e40af; padding: 2px 8px; border-radius: 4px; font-size: 12px;" id="empathyScore">87.3</span>
                            </div>
                        </div>
                        
                        <button class="button" style="width: 100%;" onclick="openAITraining()">
                            Start AI Training
                        </button>
                    </div>
                    
                    <!-- Recent Activity -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Recent Activity</div>
                        </div>
                        
                        <div id="recentActivity">
                            <!-- Activity items will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let dashboardData = null;
        
        // Check authentication and load dashboard
        async function initDashboard() {
            try {
                // Check if authenticated
                const authResponse = await fetch('/api/business/auth/me');
                const authData = await authResponse.json();
                
                if (!authData.success) {
                    window.location.href = '/backend';
                    return;
                }
                
                // Update user info
                document.getElementById('userInfo').textContent = 
                    `Welcome, ${authData.user.firstName} ${authData.user.lastName}`;
                
                // Load dashboard data
                await loadDashboardData();
                
            } catch (error) {
                console.error('Dashboard init error:', error);
                showError('Failed to initialize dashboard');
            }
        }
        
        async function loadDashboardData() {
            try {
                const response = await fetch('/api/business/dashboard/analytics');
                const data = await response.json();
                
                if (data.success) {
                    dashboardData = data.analytics;
                    renderDashboard();
                } else {
                    showError('Failed to load dashboard data');
                }
            } catch (error) {
                console.error('Load dashboard error:', error);
                showError('Network error loading dashboard');
            }
        }
        
        function renderDashboard() {
            const { overview, aiPerformance } = dashboardData;
            
            // Update stats
            document.getElementById('totalUsers').textContent = overview.totalUsers.toLocaleString();
            document.getElementById('userGrowth').textContent = `+${overview.newUsersThisWeek || 0} this week`;
            document.getElementById('activeAssessments').textContent = overview.activeUsers || 0;
            document.getElementById('completionRate').textContent = `${Math.round(overview.userRetentionRate || 0)}%`;
            document.getElementById('aiPerformance').textContent = `${Math.round((aiPerformance.avgEmpathyScore + aiPerformance.avgMedicalAccuracy) / 2)}%`;
            
            // Update AI training status
            document.getElementById('activeSessions').textContent = `${aiPerformance.totalSessions || 0} Active`;
            document.getElementById('medicalAccuracy').textContent = `${aiPerformance.avgMedicalAccuracy || 0}%`;
            document.getElementById('empathyScore').textContent = aiPerformance.avgEmpathyScore || 0;
            
            // Render quick actions
            renderQuickActions();
            
            // Render recent activity
            renderRecentActivity();
            
            // Show dashboard
            document.getElementById('loading').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
        }
        
        function renderQuickActions() {
            const actions = [
                {
                    title: 'AI Training',
                    description: 'Train Dr. Sakura with health scenarios',
                    icon: '🧠',
                    color: '#3b82f6',
                    action: 'openAITraining()'
                },
                {
                    title: 'User Analytics',
                    description: 'View user engagement and outcomes',
                    icon: '📊',
                    color: '#10b981',
                    action: 'openAnalytics()'
                },
                {
                    title: 'Avatar Settings',
                    description: 'Configure Dr. Sakura personality',
                    icon: '⚙️',
                    color: '#8b5cf6',
                    action: 'openSettings()'
                },
                {
                    title: 'System Health',
                    description: 'Monitor platform performance',
                    icon: '🏥',
                    color: '#f59e0b',
                    action: 'openHealth()'
                }
            ];
            
            const actionsHTML = actions.map(action => `
                <div class="action-card" onclick="${action.action}">
                    <div class="action-icon" style="background: ${action.color};">
                        ${action.icon}
                    </div>
                    <div class="action-title">${action.title}</div>
                    <div class="action-desc">${action.description}</div>
                </div>
            `).join('');
            
            document.getElementById('quickActions').innerHTML = actionsHTML;
        }
        
        function renderRecentActivity() {
            const activities = dashboardData.recentActivity || [];
            
            const activityHTML = activities.map(activity => `
                <div class="activity-item">
                    <div class="activity-dot" style="background: ${getActivityColor(activity.type)};"></div>
                    <div class="activity-content">
                        <div class="activity-title">${activity.message}</div>
                        <div class="activity-desc">${formatTime(activity.timestamp)}</div>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('recentActivity').innerHTML = activityHTML || '<p style="text-align: center; color: #6b7280; font-size: 14px;">No recent activity</p>';
        }
        
        function getActivityColor(type) {
            const colors = {
                user_registration: '#10b981',
                ai_training: '#3b82f6',
                system_update: '#8b5cf6',
                user_action: '#f59e0b',
                ai_interaction: '#ec4899',
                whatsapp: '#06b6d4'
            };
            return colors[type] || '#6b7280';
        }
        
        function formatTime(timestamp) {
            const now = new Date();
            const time = new Date(timestamp);
            const diffMs = now - time;
            const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
            
            if (diffHours < 1) return 'Just now';
            if (diffHours < 24) return `${diffHours} hours ago`;
            return time.toLocaleDateString();
        }
        
        function showError(message) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('error').style.display = 'block';
        }
        
        // Action functions
        function openAITraining() {
            alert('AI Training interface coming soon! This will allow you to train Dr. Sakura with new scenarios and improve response quality.');
        }
        
        function openAnalytics() {
            alert('Advanced Analytics interface coming soon! This will show detailed user engagement, health outcomes, and platform metrics.');
        }
        
        function openSettings() {
            alert('Avatar Settings interface coming soon! This will allow you to customize Dr. Sakura\'s personality, responses, and behavior.');
        }
        
        function openHealth() {
            alert('System Health interface coming soon! This will show real-time platform status, performance metrics, and alerts.');
        }
        
        async function logout() {
            try {
                const response = await fetch('/api/business/auth/logout', {
                    method: 'POST'
                });
                
                if (response.ok) {
                    window.location.href = '/backend';
                }
            } catch (error) {
                console.error('Logout error:', error);
                alert('Logout failed. Please try again.');
            }
        }
        
        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', initDashboard);
    </script>
</body>
</html>